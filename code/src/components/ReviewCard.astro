---
import type { TasteAttribute, WeatherCondition, Mood, Location, Strength, Atmosphere } from '../content/config';
import { getWeatherIcon } from '../utils/weather';

interface Props {
  title: string;
  rating: number;
  attributes: {
    positive: TasteAttribute[];
    negative: TasteAttribute[];
  };
  strength?: Strength;
  location?: Location;
  mapsUrl?: string;
  website?: string;
  instagram?: string;
  weather?: WeatherCondition;
  mood?: Mood;
  atmosphere?: Atmosphere;
  date?: Date;
}

const { title, rating, attributes, strength, location, mapsUrl, website, instagram, weather, mood, atmosphere, date } = Astro.props;

const formatDate = (date: Date) => {
  return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
};

const metadataItems: Array<{ type: string; value: string; link?: string }> = [];
if (location && mapsUrl) {
  metadataItems.push({ type: 'location', value: location, link: mapsUrl });
} else if (location) {
  metadataItems.push({ type: 'text', value: location });
}
if (weather) {
  metadataItems.push({ type: 'weather', value: weather });
}
if (mood) {
  metadataItems.push({ type: 'mood', value: mood });
}
if (atmosphere) {
  metadataItems.push({ type: 'atmosphere', value: atmosphere });
}

const showMetadata = metadataItems.length > 0 || website || instagram;
---

<article class="flex flex-col">
  {date && (
    <div class="text-[10px] text-stone-400 font-bold uppercase tracking-[0.2em] mb-2">
      {formatDate(date)}
    </div>
  )}
  <div class="flex items-baseline justify-between mb-3">
    <h2 class="text-3xl md:text-5xl font-titan text-stone-900 leading-none uppercase">
      {title}
    </h2>
    <span class="text-2xl md:text-4xl font-titan text-primary">{rating}</span>
  </div>

  <div class="flex flex-wrap gap-x-2 gap-y-1 mb-5">
    {attributes.positive.map((attr) => (
      <span class="attribute-text">(+ {attr})</span>
    ))}
    {attributes.positive.length > 0 && attributes.negative.length > 0 && (
      <span class="attribute-text">/</span>
    )}
    {attributes.negative.map((attr) => (
      <span class="attribute-text">(- {attr})</span>
    ))}
    {strength && (
      <span class="attribute-text">â€” {strength}</span>
    )}
  </div>

  <div class="text-stone-600 text-[15px] md:text-[19px] leading-relaxed font-normal mb-6">
    <slot />
  </div>

  {showMetadata && (
    <div class="pt-4 border-t border-stone-200/60 space-y-2">
      <div class="flex flex-wrap items-center gap-x-3 gap-y-1 text-[10px] text-stone-400 font-bold uppercase tracking-widest">
        {metadataItems.map((item, index) => (
          <>
            {index > 0 && <span class="text-stone-300">/</span>}
            {item.type === 'location' && item.link && (
              <a href={item.link} target="_blank" rel="noopener noreferrer" class="hover:text-stone-600 transition-colors underline decoration-dotted underline-offset-2">
                {item.value} â†—
              </a>
            )}
            {item.type === 'text' && <span>{item.value}</span>}
            {item.type === 'weather' && <span>{getWeatherIcon(item.value as WeatherCondition)} {item.value}</span>}
            {item.type === 'mood' && <span class="italic text-stone-500">Self: {item.value}</span>}
            {item.type === 'atmosphere' && <span class="italic text-stone-500">Place: {item.value}</span>}
          </>
        ))}
      </div>
      {(website || instagram) && (
        <div class="flex flex-wrap items-center gap-x-3 gap-y-1 text-[10px]">
          {website && (
            <a href={website} target="_blank" rel="noopener noreferrer" class="text-stone-400 hover:text-primary transition-colors font-bold uppercase tracking-widest">
              ğŸŒ Website
            </a>
          )}
          {instagram && (
            <a href={`https://instagram.com/${instagram.replace('@', '')}`} target="_blank" rel="noopener noreferrer" class="text-stone-400 hover:text-primary transition-colors font-bold uppercase tracking-widest">
              ğŸ“· @{instagram.replace('@', '')}
            </a>
          )}
        </div>
      )}
    </div>
  )}
</article>
